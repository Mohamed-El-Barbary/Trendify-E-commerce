<header class="pb-14">
  <div class="h-40"></div>
  <div class="nav-breadcrumb !max-w-7xl px-8 2xl:p-0 mx-auto">
    <p-breadcrumb class="" [model]="links">
      <ng-template #item let-item>
        @if (item.route) {
        <a
          [routerLink]="item.route"
          class="p-breadcrumb-item-link flex items-center gap-2 px-3 py-2 text-white hover:opacity-80 transition duration-300"
        >
          @if (item.icon) {
          <span [ngClass]="[item.icon, 'text-lg text-white']"></span>
          }
          <span class="text-main-color text-lg font-medium">
            {{ item.label }}
          </span>
        </a>
        } @else {
        <span class="text-second-text font-medium text-lg">
          {{ item.label }}
        </span>
        }
      </ng-template>
    </p-breadcrumb>
  </div>
</header>
@if (productDetails) {
<section
  class="product-main-info max-w-7xl mx-auto pt-5 pb-20 px-3 md:px-8 2xl:px-0"
>
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
    <div
      class="images grid grid-cols-1 md:grid-cols-[minmax(0,1fr)_85%] gap-4 relative"
    >
      <div
        class="swiper-content relative flex-grow border-gray-400 hidden md:block"
      >
        <swiper-container
          #swiperContainer
          class="mySwiper flex-grow space-y-5 px-1 relative"
          direction="vertical"
          slides-per-view="4"
          space-between="0"
          grab-cursor="true"
          [initial-slide]="productDetails.images.length - 1"
          observer="true"
        >
          @for (img of productDetails.images; track $index) {
          <swiper-slide
            class="bg-gray-900 !h-auto border border-main-color !mb-[2px] !mt-1 rounded-xl overflow-hidden"
          >
            <img [src]="img" alt="Product Details" />
          </swiper-slide>
          }
        </swiper-container>
        <button
          (click)="categorySlider('prev')"
          class="absolute -top-9 z-50 left-1/2 -translate-x-1/2 hover:bg-main-color px-3 rounded-lg hover:text-white text-main-color transition-all duration-300"
          aria-label="prev"
        >
          <i class="fa-solid fa-chevron-up text-2xl"></i>
        </button>
        <button
          (click)="categorySlider('next')"
          class="absolute bottom-48 z-50 left-1/2 -translate-x-1/2 hover:bg-main-color px-3 rounded-lg hover:text-white text-main-color transition-all duration-300"
          aria-label="next"
        >
          <i class="fa-solid fa-chevron-down text-2xl"></i>
        </button>
      </div>
      <div
        class="swiper-content relative flex-grow border-gray-400 order-2 md:hidden"
      >
        <swiper-container
          #swiperContainer
          class="mySwiper flex-grow space-y-5 px-1 relative"
          slides-per-view="5"
          space-between="10"
          grab-cursor="true"
          [initial-slide]="productDetails.images.length - 1"
          observer="true"
          navigation="true"
        >
          @for (img of productDetails.images; track $index) {
          <swiper-slide
            class="bg-gray-900 text-center !h-100px border border-main-color !mb-[2px] !mt-1 rounded-xl overflow-hidden"
          >
            <img [src]="img" alt="Product Details" />
          </swiper-slide>
          }
        </swiper-container>
      </div>
      <div class="main-images order-1">
        <img
          [src]="productDetails.imageCover"
          class="flex-grow w-full md:h-[630px] object-cover"
          [alt]="productDetails.title"
          aria-label="productDetails.title"
        />
      </div>

      <div
        role="button"
        (click)="updateProductWishlist(productDetails._id)"
        class="wishlist-icon absolute flex justify-center items-center top-5 right-5 text-2xl w-[45px] h-[45px] rounded-full bg-white border border-main-color"
      >
        @if (wishlistService.wishlist().includes(productDetails._id)) {
        <i class="fa-solid fa-heart text-main-color"></i>
        } @else {
        <i class="fa-regular fa-heart text-main-color"></i>
        }
      </div>
    </div>

    <div class="product-info flex flex-col gap-6">
      <span>
        <i class="fas fa-star text-yellow-400"></i>
        {{ productDetails.ratingsAverage }}
      </span>

      <h1 class="text-[32px] font-semibold text-text-color">
        {{ productDetails.title.split(" ").slice(0, 3).join(" ") }}
      </h1>

      <p
        class="text-base text-[#667085] overflow-hidden whitespace-nowrap text-ellipsis inline-block"
      >
        {{ productDetails.description }}
      </p>

      <div class="product-color flex flex-col gap-3">
        <p>
          <span class="text-xl text-text-color font-medium">Color : </span>
          <span class="text-xl text-second-text">{{ selectedColor() }} </span>
        </p>
        <div class="flex items-center gap-3">
          @for (color of productsColors; track color.hex) {
          <span
            class="w-10 h-10 rounded-full cursor-pointer border-2"
            [class.p-6]="selectedColor() === color.name"
            [style.backgroundColor]="color.hex"
            (click)="setSelectedColor(color.name)"
          >
          </span>
          }
        </div>
      </div>

      <div class="product-size flex flex-col gap-3">
        <div class="flex justify-between max-w-[450px]">
          <p>
            <span class="text-xl text-text-color font-medium">Size : </span>
            <span class="text-xl text-second-text">{{ selectedSize() }}</span>
          </p>
          <p class="text-xl underline text-main-color font-medium">
            Size Guide
          </p>
        </div>
        <div class="flex items-center gap-1 md:gap-3">
          @for (size of productsSize; track size.size) {
          <span
            class="py-2 p-3 md:px-4 bg-[#FCFCFD] text-[#667085] flex items-center justify-center border-2 rounded-md text-sm cursor-pointer md:text-base transition-all duration-200"
            [ngClass]="{
              'border-[#F1F7FA] text-main-color bg-[#F1F7FA]':
                selectedSize() === size.value,
              '': selectedSize() !== size.value
            }"
            (click)="setSelectedSize(size.value)"
          >
            {{ size.size }}
          </span>
          }
        </div>
      </div>

      <div class="about-price">
        <p>
          <span class="text-base font-medium text-text-color">Quantity :</span>
          <span class="text-base font-medium text-main-color">
            {{ productDetails.quantity }}
          </span>
        </p>
        <div
          class="addcart-btn mt-5 flex @2xs:flex-col md:flex-row items-center gap-4"
        >
          <div
            class="buy-quantity flex items-center bg-white border border-[#8B5D37] px-2 md:px-4 py-3 rounded-lg shadow-sm"
          >
            <button
              pButton
              class="p-button-text text-[#667085] text-lg px-3"
              aria-label="btton"
              (click)="decreaseQuantity()"
            >
              <i class="fa-solid fa-minus"></i>
            </button>

            <span class="text-lg font-semibold text-text-color px-3">
              {{ countcart }}
            </span>

            <button
              pButton
              aria-label="btton"
              class="add-cart p-button-text text-[#667085] text-lg px-3"
              (click)="increaseQuantity()"
            >
              <i class="fa-solid fa-plus"></i>
            </button>
          </div>

          <button
            (click)="addProductToCart(productDetails._id)"
            pButton
            class="bg-main-color text-white flex justify-center gap-4 text-lg font-medium flex-grow px-6 py-3 rounded-lg shadow-md hover:bg-opacity-90 transition-all duration-200"
          >
            <span class="font-bold">
              {{ getPriceOfProduct() | currency : "EGP" }}
            </span>
            <span>•</span>
            <span class="flex gap-3 items-center">
              Add to Cart
              <!-- IsLoading -->
              @if (cartLoading.cartMainItemLoading) {
              <i class="fa-solid fa-circle-notch fa-spin"></i>
              }
            </span>
          </button>
        </div>
      </div>

      <div class="delivery-info flex items-center gap-2 p-3 rounded-md">
        <i class="fa-solid fa-truck-fast text-[#667085]"></i>
        <p class="text-[#667085]">
          Estimated Delivery:
          <span class="italic text-text-color font-medium">
            {{ estimatedStartDate() }} - {{ estimatedEndDate() }}
          </span>
        </p>
      </div>
    </div>
  </div>
</section>

<section class="product-details max-w-7xl mx-auto px-8 2xl:px-0 pt-5 pb-10">
  <div class="card flex justify-content-center">
    <p-accordion value="0">
      <p-accordion-panel value="1">
        <p-accordion-header class="!bg-bg-color">
          <ng-template #toggleicon let-active="active">
            @if (active) {
            <button aria-label="minus">
              <i class="pi pi-minus text-[#3A3845]"></i>
            </button>
            } @else {
            <button aria-label="plus">
              <i class="pi pi-plus text-[#3A3845]"></i>
            </button>
            }
          </ng-template>
          <span class="flex items-center gap-2 flex-grow">
            <span
              class="font-medium text-2xl whitespace-nowrap text-text-color"
            >
              Details
            </span>
            <p-badge value="3" class="ml-auto mr-2" />
          </span>
        </p-accordion-header>
        <p-accordion-content>
          <p class="m-0 pt-5">
            {{ productDetails.description }}
          </p>
        </p-accordion-content>
      </p-accordion-panel>
      <p-accordion-panel value="2">
        <p-accordion-header class="!bg-bg-color">
          <ng-template #toggleicon>
            <button aria-label="plus" disabled>
              <i class="pi pi-plus !text-second-text"></i>
            </button>
          </ng-template>
          <span class="flex items-center gap-2 flex-grow">
            <span class="font-medium text-2xl whitespace-nowrap text-text-color"
              >Dimensions</span
            >
            <p-badge value="4" class="ml-auto mr-2" />
          </span>
        </p-accordion-header>
      </p-accordion-panel>
      <p-accordion-panel value="3">
        <p-accordion-header class="!bg-bg-color">
          <ng-template #toggleicon let-active="active">
            @if (active) {
            <button aria-label="minus">
              <i class="pi pi-minus text-[#3A3845]"></i>
            </button>
            } @else {
            <button aria-label="plus">
              <i class="pi pi-plus text-[#3A3845]"></i>
            </button>
            }
          </ng-template>
          <span class="flex items-center gap-2 flex-grow">
            <span
              class="font-medium text-2xl whitespace-nowrap text-text-color"
            >
              Reviews
            </span>
            <p-badge value="2" class="ml-auto mr-2" />
          </span>
        </p-accordion-header>
        <p-accordion-content class="!bg-bg-color">
          <div class="custom-accordion-content">
            <div
              class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6"
            >
              <!-- Employee Reviews Summary -->
              <div class="p-6 h-fit bg-white rounded-xl shadow">
                <h2 class="text-sm font-medium text-[#0D0C22]">
                  Employee Reviews
                </h2>
                <div class="flex flex-col mb-4">
                  <span class="text-[40px] font-bold text-text-color mb-1">
                    {{ productRating }}
                  </span>
                  <div class="flex mb-3">
                    <!-- نجوم ممتلئة -->
                    @for (_ of fullStarsArray; track _){
                    <span class="text-yellow-500 text-xl">
                      <i class="fa-solid fa-star"></i>
                    </span>
                    }

                    <!-- نصف نجمة -->
                    @if (hasHalfStar()){
                    <span class="text-yellow-500 text-xl">
                      <i class="fa-solid fa-star-half-stroke"></i>
                    </span>
                    }

                    <!-- نجوم فارغة -->
                    @for (_ of emptyStarsArray; track _){
                    <span class="text-gray-300 text-xl">
                      <i class="fa-solid fa-star"></i>
                    </span>
                    }
                  </div>
                  <p class="text-gray-500 text-sm">
                    ({{ productDetails.ratingsQuantity }} Reviews)
                  </p>
                </div>

                <!-- Rating Bars -->
                <div class="mt-4 space-y-3">
                  <div class="flex items-center gap-2">
                    <span class="text-xs font-medium text-text-color"
                      >5 stars</span
                    >
                    <div class="flex-grow h-2 bg-gray-200 rounded-full">
                      <div
                        class="bg-yellow-400 h-2 rounded-full"
                        style="width: 85%"
                      ></div>
                    </div>
                    <span class="text-xs font-medium text-text-color">488</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs font-medium text-text-color">
                      4 stars
                    </span>
                    <div class="flex-grow h-2 bg-gray-200 rounded-full">
                      <div
                        class="bg-yellow-400 h-2 rounded-full"
                        style="width: 20%"
                      ></div>
                    </div>
                    <span class="text-xs font-medium text-text-color">74</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs font-medium text-text-color"
                      >3 stars</span
                    >
                    <div class="flex-grow h-2 bg-gray-200 rounded-full">
                      <div
                        class="bg-yellow-400 h-2 rounded-full"
                        style="width: 5%"
                      ></div>
                    </div>
                    <span class="text-xs font-medium text-text-color">14</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs font-medium text-text-color"
                      >2 stars</span
                    >
                    <div class="flex-grow h-2 bg-gray-200 rounded-full">
                      <div class="bg-gray-200 h-2 rounded-full"></div>
                    </div>
                    <span class="text-xs font-medium text-text-color">0</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs font-medium text-text-color"
                      >1 star</span
                    >
                    <div class="flex-grow h-2 bg-gray-200 rounded-full">
                      <div class="bg-gray-200 h-2 rounded-full"></div>
                    </div>
                    <span class="text-xs font-medium text-text-color">0</span>
                  </div>
                </div>
              </div>

              <!-- Reviews Section -->
              <div class="p-6 rounded-xl shadow bg-white">
                <!-- Review 1 -->
                <div class="border-b pb-8 mb-4">
                  <p class="text-gray-500 text-sm mb-2">Jan 20, 2024</p>
                  <ul class="flex gap-1 mb-2">
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                  </ul>
                  <div class="flex items-center gap-2 mt-1 mb-3">
                    <div
                      class="w-10 h-10 bg-[#E8DFD7] flex items-center justify-center rounded-full text-sm font-semibold"
                    >
                      <span class="text-[#8B5E35]">Ak</span>
                    </div>
                    <div>
                      <p class="font-medium text-sm text-text-color">Alex K.</p>
                    </div>
                  </div>
                  <p class="text-sm font-medium text-second-text">
                    Senior Analyst
                  </p>
                  <p class="mt-2 text-sm font-medium text-[#37373B]">
                    Lorem ipsum dolor sit amet consectetur. Egestas tincidunt
                    sed laoreet urna id morbi turpis. Est elit egestas
                  </p>
                </div>

                <!-- Review 2 -->
                <div class="pb-5 pt-4 mt-4">
                  <p class="text-gray-500 text-sm mb-2">Jan 20, 2024</p>
                  <ul class="flex gap-1 mb-2">
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                  </ul>
                  <div class="flex items-center gap-2 mt-1 mb-3">
                    <div
                      class="w-10 h-10 bg-[#E8DFD7] flex items-center justify-center rounded-full text-sm font-semibold"
                    >
                      <span class="text-[#8B5E35]">Ak</span>
                    </div>
                    <div>
                      <p class="font-medium text-sm text-text-color">Alex K.</p>
                    </div>
                  </div>
                  <p class="text-sm font-medium text-second-text">
                    Senior Analyst
                  </p>
                  <p class="mt-2 text-sm font-medium text-[#37373B]">
                    Lorem ipsum dolor sit amet consectetur. Egestas tincidunt
                    sed laoreet urna id morbi turpis. Est elit egestas
                  </p>
                </div>
              </div>
            </div>
          </div>
        </p-accordion-content>
      </p-accordion-panel>
    </p-accordion>
  </div>
</section>

<section class="similar-product max-w-7xl mx-auto px-8 2xl:px-0 pb-16">
  <h2 class="text-[40px] font-semibold text-text-color">Similar products</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-10">
    @for (product of filterProductByCategory; track product._id) {
    <div
      [routerLink]="['/products/details', product._id]"
      (click)="scrollToTop()"
      class="bg-white p-2 rounded-2xl shadow-md cursor-pointer"
    >
      <div class="image relative">
        <img
          [src]="product.imageCover"
          [alt]="product.title"
          class="rounded-xl w-full h-[280px] object-contain bg-[#F1F1F1]"
          aria-label="product.title"
        />
        <span
          class="absolute bottom-3 left-2 bg-main-color text-white px-3 py-1 text-xl font-semibold"
          >-20 %</span
        >
        <div
          (click)="updateProductWishlist(product._id)"
          (click)="preventPropagation($event)"
          aria-label="wishlist"
          role="button"
          class="absolute flex items-center justify-center top-3 right-3 text-2xl w-[40px] h-[40px] bg-white rounded-full"
        >
          @if (wishlistService.wishlist().includes(product._id)) {
          <i class="fa-solid fa-heart text-main-color"></i>
          } @else {
          <i class="fa-regular fa-heart text-main-color"></i>
          }
        </div>
      </div>
      <div class="crat-body mb-2 p-1">
        <h3
          class="text-2xl font-medium max-w-full text-text-color mt-3 mb-1 overflow-hidden whitespace-nowrap text-ellipsis inline-block"
        >
          {{ product.title }}
        </h3>
        <p class="text-sm text-text-color flex gap-2 items-center">
          <span
            ><i class="fa-solid fa-star text-yellow-400"></i>
            {{ product.ratingsAverage }}</span
          >
          <span class="text-second-color text-xs">(500+)</span>
        </p>
      </div>
      <div class="cart-footer flex items-center relative p-1 pb-4">
        <p class="font-bold text-main-color text-xl">
          {{ (product.price * 80) / 100 }}
          <span class="line-through text-second-text">{{ product.price }}</span>
        </p>
        <div
          (click)="addProductToCart(product._id)"
          (click)="preventPropagation($event)"
          class="absolute right-0 text-3xl p-2"
        >
          @if (cartLoading.cartLoading[product._id]) {
          <span
            class="w-[30px] h-[30px] flex items-center justify-center text-white bg-main-color rounded-lg"
          >
            <i
              class="fa-solid fa-spinner fa-spin-pulse fa-spin-reverse text-lg"
            ></i>
          </span>
          }@else{
          <i class="fa-solid fa-square-plus text-main-color rounded-lg"></i>
          }
        </div>
      </div>
    </div>
    }
  </div>
</section>

} @else if (productShopifyDetails) {
<section
  class="product-main-info max-w-7xl mx-auto pt-5 pb-20 px-3 md:px-8 2xl:px-0"
>
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
    <div class="images grid grid-cols-[minmax(0,1fr)_85%] gap-4 relative">
      <div class="relative flex-grow h-full">
        <swiper-container
          #swiperContainer
          class="mySwiper flex-grow space-y-5"
          direction="vertical"
          slides-per-view="4"
          centered-slides="false"
          space-between="0"
          grab-cursor="true"
        >
          @for (img of productShopifyDetails.images; track $index) {
          <swiper-slide
            class="bg-gray-900 !h-auto border border-main-color !mb-[2px] !mt-1 rounded-xl overflow-hidden"
          >
            <img [src]="img.src" alt="Product Details" />
          </swiper-slide>
          }
        </swiper-container>
        <button
          (click)="categorySlider('prev')"
          class="absolute -top-9 z-50 left-1/2 -translate-x-1/2 hover:bg-main-color px-3 rounded-lg hover:text-white text-main-color transition-all duration-300"
          aria-label="prev"
        >
          <i class="fa-solid fa-chevron-up text-2xl"></i>
        </button>
        <button
          (click)="categorySlider('next')"
          class="absolute bottom-48 z-50 left-1/2 -translate-x-1/2 hover:bg-main-color px-3 rounded-lg hover:text-white text-main-color transition-all duration-300"
          aria-label="next"
        >
          <i class="fa-solid fa-chevron-down text-2xl"></i>
        </button>
      </div>

      <div class="main-images">
        <img
          [src]="productShopifyDetails.image?.src || productShopifyDetails.images?.[0]?.src"
          class="flex-grow w-full lg:h-[630px] object-cover"
          [alt]="productShopifyDetails.title"
          aria-label="productShopifyDetails.title"
        />
      </div>
      <div
        class="wishlist-icon absolute flex justify-center items-center top-5 right-5 text-2xl w-[45px] h-[45px] rounded-full bg-white border border-main-color"
      >
        <i class="fa-regular fa-heart text-main-color"></i>
      </div>
    </div>

    <div class="product-info flex flex-col gap-6">
      <span>
        <i class="fas fa-star text-yellow-400"></i>
        4.5 (400)
      </span>

      <h1 class="text-[32px] font-semibold text-text-color">
        {{ productShopifyDetails.title }}
      </h1>

      <div
        class="description text-base text-[#667085] overflow-hidden whitespace-nowrap text-ellipsis inline-block"
      >
        <p
          [innerHTML]="
            productShopifyDetails.body_html.split(' ').slice(0, 13).join(' ') +
            '...'
          "
        ></p>
      </div>

      <div class="product-color flex flex-col gap-3">
        <p>
          <span class="text-xl text-text-color font-medium">Color : </span>
          <span class="text-xl text-second-text">{{ selectedColor() }} </span>
        </p>
        <div class="flex items-center gap-3">
          @for (color of productsColors; track color.hex) {
          <span
            class="w-10 h-10 rounded-full cursor-pointer border-2"
            [class.p-6]="selectedColor() === color.name"
            [style.backgroundColor]="color.hex"
            (click)="setSelectedColor(color.name)"
          >
          </span>
          }
        </div>
      </div>

      <div class="product-size flex flex-col gap-3">
        <div class="flex justify-between max-w-[450px]">
          <p>
            <span class="text-xl text-text-color font-medium">Size : </span>
            <span class="text-xl text-second-text">{{ selectedSize() }}</span>
          </p>
          <p class="text-xl underline text-main-color font-medium">
            Size Guide
          </p>
        </div>
        <div class="flex items-center gap-1 md:gap-3">
          @for (size of productsSize; track size.size) {
          <span
            class="py-2 p-3 md:px-4 bg-[#FCFCFD] text-[#667085] flex items-center justify-center border-2 rounded-md text-sm cursor-pointer md:text-base transition-all duration-200"
            [ngClass]="{
              'border-[#F1F7FA] text-main-color bg-[#F1F7FA]':
                selectedSize() === size.value,
              '': selectedSize() !== size.value
            }"
            (click)="setSelectedSize(size.value)"
          >
            {{ size.size }}
          </span>
          }
        </div>
      </div>

      <div class="about-price">
        <p>
          <span class="text-base font-medium text-text-color">Quantity :</span>
          <span class="text-base font-medium text-main-color">
            {{ productShopifyDetails.variants[0].inventory_quantity }}
          </span>
        </p>
        <div
          class="addcart-btn mt-5 flex @2xs:flex-col md:flex-row items-center gap-4"
        >
          <div
            class="buy-quantity flex items-center bg-white border border-[#8B5D37] px-2 md:px-4 py-3 rounded-lg shadow-sm"
          >
            <button
              pButton
              class="p-button-text text-[#667085] text-lg px-3"
              aria-label="btton"
              (click)="decreaseQuantity()"
            >
              <i class="fa-solid fa-minus"></i>
            </button>

            <span class="text-lg font-semibold text-text-color px-3">
              {{ countcart }}
            </span>

            <button
              pButton
              aria-label="btton"
              class="add-cart p-button-text text-[#667085] text-lg px-3"
              (click)="increaseQuantity()"
            >
              <i class="fa-solid fa-plus"></i>
            </button>
          </div>

          <!-- (click)="addProductToCart(productShopifyDetails.id)" -->
          <button
            pButton
            class="bg-main-color text-white flex justify-center gap-4 text-lg font-medium flex-grow px-6 py-3 rounded-lg shadow-md hover:bg-opacity-90 transition-all duration-200"
          >
            <span class="font-bold">
              {{ getPriceOfProduct() | currency : "EGP" }}
            </span>
            <span>•</span>
            <span class="flex gap-3 items-center">
              Add to Cart
              <!-- IsLoading -->
              @if (cartLoading.cartMainItemLoading) {
              <i class="fa-solid fa-circle-notch fa-spin"></i>
              }
            </span>
          </button>
        </div>
      </div>

      <div class="delivery-info flex items-center gap-2 p-3 rounded-md">
        <i class="fa-solid fa-truck-fast text-[#667085]"></i>
        <p class="text-[#667085]">
          Estimated Delivery:
          <span class="italic text-text-color font-medium">
            {{ estimatedStartDate() }} - {{ estimatedEndDate() }}
          </span>
        </p>
      </div>
    </div>
  </div>
</section>

<section class="product-details max-w-7xl mx-auto px-8 2xl:px-0 pt-5 pb-10">
  <div class="card flex justify-content-center">
    <p-accordion value="0">
      <p-accordion-panel value="1">
        <p-accordion-header class="!bg-bg-color">
          <ng-template #toggleicon let-active="active">
            @if (active) {
            <button aria-label="minus">
              <i class="pi pi-minus text-[#3A3845]"></i>
            </button>
            } @else {
            <button aria-label="plus">
              <i class="pi pi-plus text-[#3A3845]"></i>
            </button>
            }
          </ng-template>
          <span class="flex items-center gap-2 flex-grow">
            <span
              class="font-medium text-2xl whitespace-nowrap text-text-color"
            >
              Details
            </span>
            <p-badge value="3" class="ml-auto mr-2" />
          </span>
        </p-accordion-header>
        <p-accordion-content>
          <p [innerHTML]="productShopifyDetails.body_html" class="m-0 pt-5"></p>
        </p-accordion-content>
      </p-accordion-panel>
      <p-accordion-panel value="2">
        <p-accordion-header class="!bg-bg-color">
          <ng-template #toggleicon>
            <button aria-label="plus" disabled>
              <i class="pi pi-plus !text-second-text"></i>
            </button>
          </ng-template>
          <span class="flex items-center gap-2 flex-grow">
            <span class="font-medium text-2xl whitespace-nowrap text-text-color"
              >Dimensions</span
            >
            <p-badge value="4" class="ml-auto mr-2" />
          </span>
        </p-accordion-header>
      </p-accordion-panel>
      <p-accordion-panel value="3">
        <p-accordion-header class="!bg-bg-color">
          <ng-template #toggleicon let-active="active">
            @if (active) {
            <button aria-label="minus">
              <i class="pi pi-minus text-[#3A3845]"></i>
            </button>
            } @else {
            <button aria-label="plus">
              <i class="pi pi-plus text-[#3A3845]"></i>
            </button>
            }
          </ng-template>
          <span class="flex items-center gap-2 flex-grow">
            <span
              class="font-medium text-2xl whitespace-nowrap text-text-color"
            >
              Reviews
            </span>
            <p-badge value="2" class="ml-auto mr-2" />
          </span>
        </p-accordion-header>
        <p-accordion-content class="!bg-bg-color">
          <div class="custom-accordion-content">
            <div
              class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6"
            >
              <!-- Employee Reviews Summary -->
              <div class="p-6 h-fit bg-white rounded-xl shadow">
                <h2 class="text-sm font-medium text-[#0D0C22]">
                  Employee Reviews
                </h2>
                <div class="flex flex-col mb-4">
                  <span class="text-[40px] font-bold text-text-color mb-1">
                    4.5
                  </span>
                  <div class="mb-3">
                    <ul class="flex gap-1">
                      <li>
                        <i class="fa-solid fa-star text-yellow-500 text-xl"></i>
                      </li>
                      <li>
                        <i class="fa-solid fa-star text-yellow-500 text-xl"></i>
                      </li>
                      <li>
                        <i class="fa-solid fa-star text-yellow-500 text-xl"></i>
                      </li>
                      <li>
                        <i class="fa-solid fa-star text-yellow-500 text-xl"></i>
                      </li>
                      <li>
                        <i class="fa-solid fa-star text-second-text text-xl">
                        </i>
                      </li>
                    </ul>
                  </div>
                  <p class="text-gray-500 text-sm">(400 Reviews)</p>
                </div>

                <!-- Rating Bars -->
                <div class="mt-4 space-y-3">
                  <div class="flex items-center gap-2">
                    <span class="text-xs font-medium text-text-color"
                      >5 stars</span
                    >
                    <div class="flex-grow h-2 bg-gray-200 rounded-full">
                      <div
                        class="bg-yellow-400 h-2 rounded-full"
                        style="width: 85%"
                      ></div>
                    </div>
                    <span class="text-xs font-medium text-text-color">488</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs font-medium text-text-color">
                      4 stars
                    </span>
                    <div class="flex-grow h-2 bg-gray-200 rounded-full">
                      <div
                        class="bg-yellow-400 h-2 rounded-full"
                        style="width: 20%"
                      ></div>
                    </div>
                    <span class="text-xs font-medium text-text-color">74</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs font-medium text-text-color"
                      >3 stars</span
                    >
                    <div class="flex-grow h-2 bg-gray-200 rounded-full">
                      <div
                        class="bg-yellow-400 h-2 rounded-full"
                        style="width: 5%"
                      ></div>
                    </div>
                    <span class="text-xs font-medium text-text-color">14</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs font-medium text-text-color"
                      >2 stars</span
                    >
                    <div class="flex-grow h-2 bg-gray-200 rounded-full">
                      <div class="bg-gray-200 h-2 rounded-full"></div>
                    </div>
                    <span class="text-xs font-medium text-text-color">0</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs font-medium text-text-color"
                      >1 star</span
                    >
                    <div class="flex-grow h-2 bg-gray-200 rounded-full">
                      <div class="bg-gray-200 h-2 rounded-full"></div>
                    </div>
                    <span class="text-xs font-medium text-text-color">0</span>
                  </div>
                </div>
              </div>

              <!-- Reviews Section -->
              <div class="p-6 rounded-xl shadow bg-white">
                <!-- Review 1 -->
                <div class="border-b pb-8 mb-4">
                  <p class="text-gray-500 text-sm mb-2">Jan 20, 2024</p>
                  <ul class="flex gap-1 mb-2">
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                  </ul>
                  <div class="flex items-center gap-2 mt-1 mb-3">
                    <div
                      class="w-10 h-10 bg-[#E8DFD7] flex items-center justify-center rounded-full text-sm font-semibold"
                    >
                      <span class="text-[#8B5E35]">Ak</span>
                    </div>
                    <div>
                      <p class="font-medium text-sm text-text-color">Alex K.</p>
                    </div>
                  </div>
                  <p class="text-sm font-medium text-second-text">
                    Senior Analyst
                  </p>
                  <p class="mt-2 text-sm font-medium text-[#37373B]">
                    Lorem ipsum dolor sit amet consectetur. Egestas tincidunt
                    sed laoreet urna id morbi turpis. Est elit egestas
                  </p>
                </div>

                <!-- Review 2 -->
                <div class="pb-5 pt-4 mt-4">
                  <p class="text-gray-500 text-sm mb-2">Jan 20, 2024</p>
                  <ul class="flex gap-1 mb-2">
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                    <li>
                      <i class="fa-solid fa-star text-yellow-400 text-sm"></i>
                    </li>
                  </ul>
                  <div class="flex items-center gap-2 mt-1 mb-3">
                    <div
                      class="w-10 h-10 bg-[#E8DFD7] flex items-center justify-center rounded-full text-sm font-semibold"
                    >
                      <span class="text-[#8B5E35]">Ak</span>
                    </div>
                    <div>
                      <p class="font-medium text-sm text-text-color">Alex K.</p>
                    </div>
                  </div>
                  <p class="text-sm font-medium text-second-text">
                    Senior Analyst
                  </p>
                  <p class="mt-2 text-sm font-medium text-[#37373B]">
                    Lorem ipsum dolor sit amet consectetur. Egestas tincidunt
                    sed laoreet urna id morbi turpis. Est elit egestas
                  </p>
                </div>
              </div>
            </div>
          </div>
        </p-accordion-content>
      </p-accordion-panel>
    </p-accordion>
  </div>
</section>

<section class="similar-product max-w-7xl mx-auto px-8 2xl:px-0 pb-16">
  <h2 class="text-[40px] font-semibold text-text-color">Similar products</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-10">
    @for (product of productShopifyCategory; track product.id) {
    <div
      [routerLink]="['/products/details', product.id]"
      (click)="scrollToTop()"
      class="bg-white p-2 rounded-2xl shadow-md cursor-pointer"
    >
      <div class="image relative">
        <img
          [src]="product.image?.src || product.images?.[0]?.src"
          [alt]="product.title"
          class="rounded-xl w-full h-[280px] object-contain bg-[#F1F1F1]"
          aria-label="product.title"
        />
        <span
          class="absolute bottom-3 left-2 bg-main-color text-white px-3 py-1 text-xl font-semibold"
          >-20 %</span
        >
        <div
          (click)="preventPropagation($event)"
          class="absolute flex items-center justify-center top-3 right-3 text-2xl w-[40px] h-[40px] bg-white rounded-full"
        >
          <i class="fa-regular fa-heart text-main-color"></i>
        </div>
      </div>
      <div class="crat-body mb-2 p-1">
        <h3
          class="text-2xl font-medium max-w-full text-text-color mt-3 mb-1 overflow-hidden whitespace-nowrap text-ellipsis inline-block"
        >
          {{ product.title }}
        </h3>
        <p class="text-sm text-text-color flex gap-2 items-center">
          <span><i class="fa-solid fa-star text-yellow-400"></i> 4.5</span>
          <span class="text-second-color text-xs">(500+)</span>
        </p>
      </div>
      <div class="cart-footer flex items-center relative p-1 pb-4">
        <p class="font-bold text-main-color text-xl">
          {{ product.variants[0].price }}
          <span class="line-through text-second-text">{{
            product.variants[0].price
          }}</span>
        </p>
        <!-- (click)="addProductToCart(product.id)" -->
        <div
          (click)="preventPropagation($event)"
          class="absolute right-0 text-3xl p-2"
        >
          @if (cartLoading.cartLoading[product.id]) {
          <span
            class="w-[30px] h-[30px] flex items-center justify-center text-white bg-main-color rounded-lg"
          >
            <i
              class="fa-solid fa-spinner fa-spin-pulse fa-spin-reverse text-lg"
            ></i>
          </span>
          }@else{
          <i class="fa-solid fa-square-plus text-main-color rounded-lg"></i>
          }
        </div>
      </div>
    </div>
    }
  </div>
</section>
}
